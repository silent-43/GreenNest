<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶ï‡¶æ‡¶∞‡ßç‡¶ü üåø GreenNest</title>
<style>
body { font-family:'Poppins', sans-serif; margin:0; background:#f0f8f5; color:#333; }
header { background: linear-gradient(90deg,#00BFA6,#00C897,#00E7B0); padding:15px 30px; display:flex; justify-content: space-between; align-items:center; }
.nav a { color:white; text-decoration:none; margin:0 15px; font-weight:600; }
.nav a:hover, .nav a.active { text-decoration:underline; }
#logoutBtn { background:white; color:#00BFA6; border:none; border-radius:20px; padding:8px 18px; font-weight:600; cursor:pointer; transition:0.2s; }
#logoutBtn:hover { background:#e6ffe9; }
.cart-container { max-width:900px; margin:40px auto; background:white; border-radius:20px; padding:30px; box-shadow:0 10px 25px rgba(0,0,0,0.1); }
.cart-container h2 { text-align:center; margin-bottom:30px; color:#00BFA6; }
.cart-item { display:flex; align-items:center; margin-bottom:15px; border-bottom:1px solid #ddd; padding-bottom:10px; }
.cart-item img { width:100px; height:100px; object-fit:cover; border-radius:15px; margin-right:20px; }
.cart-item-details { flex:1; }
button.removeBtn { background:#FF4C4C; padding:5px 10px; border:none; border-radius:10px; color:white; cursor:pointer; margin-left:10px; transition:0.2s; }
button.removeBtn:hover { background:#FF1A1A; transform:scale(1.05); }
.total { text-align:right; font-weight:700; margin-top:20px; font-size:1.2rem; color:#00BFA6; }
#checkoutBtn { background:#00BFA6; color:white; border:none; border-radius:20px; padding:12px 25px; cursor:pointer; margin-top:15px; font-weight:600; font-size:1rem; transition:0.2s; display:block; margin-left:auto; }
#checkoutBtn:hover { background:#00E7B0; }
.empty-cart { text-align:center; font-size:1.1rem; color:#777; margin-top:20px; }

/* Payment modal */
.modal-backdrop { position:fixed; inset:0; background:rgba(0,0,0,0.5); display:none; align-items:center; justify-content:center; z-index:999; }
.modal { background:white; width:90%; max-width:520px; border-radius:12px; padding:20px; box-shadow:0 8px 30px rgba(0,0,0,0.2); }
.modal h3 { color:#006f56; margin-top:0; }
.field { margin-bottom:12px; }
.field label { display:block; font-size:0.95rem; margin-bottom:6px; color:#333; }
.field input { width:100%; padding:10px 12px; border-radius:8px; border:1px solid #d0d0d0; font-size:1rem; }
.small { font-size:0.85rem; color:#666; }
.row { display:flex; gap:10px; }
.row .field { flex:1; }
.pay-actions { display:flex; justify-content:space-between; align-items:center; gap:10px; margin-top:10px; }
.btn { padding:10px 14px; border-radius:10px; border:none; cursor:pointer; font-weight:600; }
.btn.secondary { background:#f0f0f0; color:#333; }
.btn.primary { background:#00BFA6; color:white; }
.status { margin-top:10px; font-weight:600; }

/* small info row */
.demo-toggle { display:flex; align-items:center; gap:8px; margin-bottom:10px; color:#555; }
</style>
</head>
<body>

<header>
  <nav class="nav">
    <a href="index.html">‡¶π‡ßã‡¶Æ</a>
    <a href="shop.html">‡¶ó‡¶æ‡¶õ ‡¶ï‡¶ø‡¶®‡ßÅ‡¶®</a>
    <a href="categories.html">‡¶ó‡¶æ‡¶õ‡ßá‡¶∞ ‡¶ß‡¶∞‡¶®</a>
    <a href="care.html">‡¶™‡¶∞‡¶ø‡¶ö‡¶∞‡ßç‡¶Ø‡¶æ ‡¶™‡¶∞‡¶æ‡¶Æ‡¶∞‡ßç‡¶∂</a>
    <a href="about.html">‡¶Ü‡¶Æ‡¶æ‡¶¶‡ßá‡¶∞ ‡¶∏‡¶Æ‡ßç‡¶™‡¶∞‡ßç‡¶ï‡ßá</a>
    <a href="contact.html">‡¶Ø‡ßã‡¶ó‡¶æ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</a>
    <a href="profile.html">‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤</a>
  </nav>
  <button id="logoutBtn">‡¶≤‡¶ó ‡¶Ü‡¶â‡¶ü</button>
</header>

<div class="cart-container">
  <h2>‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶ï‡¶æ‡¶∞‡ßç‡¶ü</h2>
  <div id="cartItems"></div>
  <p class="total">‡¶Æ‡ßã‡¶ü ‡¶Æ‡ßÇ‡¶≤‡ßç‡¶Ø: <span id="totalAmount">‡ß¶</span> ‡¶ü‡¶æ‡¶ï‡¶æ</p>
  <button id="checkoutBtn">‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
</div>

<!-- Payment Modal -->
<div id="paymentBackdrop" class="modal-backdrop" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true" aria-labelledby="payTitle">
    <h3 id="payTitle">‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</h3>

    <div class="demo-toggle">
      <input type="checkbox" id="demoMode" checked>
      <label for="demoMode" class="small">Mark The Box</label>
    </div>

    <div id="paymentForm">
      <div class="field">
        <label>‡¶ï‡¶æ‡¶∞‡ßç‡¶°‡¶ß‡¶æ‡¶∞‡ßÄ‡¶∞ ‡¶®‡¶æ‡¶Æ</label>
        <input id="cardName" type="text" placeholder="‡¶®‡¶æ‡¶Æ (‡¶Ø‡ßá‡¶Æ‡¶®: Md. Rahim)">
      </div>

      <div class="field">
        <label>‡¶ï‡¶æ‡¶∞‡ßç‡¶° ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞</label>
        <input id="cardNumber" type="text" inputmode="numeric" placeholder="1234 5678 9012 3456" maxlength="19">
      </div>

      <div class="row">
        <div class="field">
          <label>‡¶Æ‡ßá‡¶Ø‡¶º‡¶æ‡¶¶ ‡¶∂‡ßá‡¶∑ (MM/YY)</label>
          <input id="exp" type="text" placeholder="08/26" maxlength="5">
        </div>
        <div class="field">
          <label>CVC</label>
          <input id="cvc" type="text" inputmode="numeric" placeholder="123" maxlength="4">
        </div>
      </div>

    
    </div>

    <div class="pay-actions">
      <button id="closePay" class="btn secondary">‡¶¨‡¶æ‡¶§‡¶ø‡¶≤</button>
      <div style="text-align:right;">
        <button id="payBtn" class="btn primary">‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®</button>
      </div>
    </div>

    <p id="payStatus" class="status"></p>
  </div>
</div>

<script>
const BACKEND="http://127.0.0.1:5000";

// ------------------ ‡¶∏‡ßá‡¶∂‡¶® ‡¶ö‡ßá‡¶ï ------------------
async function checkSession(){
  try {
    const res = await fetch(`${BACKEND}/check-session`, { credentials:"include" });
    const data = await res.json();
    if(!data.loggedIn) window.location.href="login.html";
  } catch(e){
    // ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï‡¶è‡¶®‡ßç‡¶° ‡¶®‡¶æ ‡¶ö‡¶≤‡¶≤‡ßá ‡¶°‡ßá‡¶Æ‡ßã ‡¶Æ‡ßã‡¶°‡ßá ‡¶∞‡¶æ‡¶ñ‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶ø ‚Äî ‡¶ï‡¶ø‡¶®‡ßç‡¶§‡ßÅ ‡¶≤‡¶ó‡¶á‡¶® ‡¶∞‡¶ø‡¶°‡¶æ‡¶á‡¶∞‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡¶¨‡ßã ‡¶®‡¶æ
    console.warn("Session check failed:", e);
  }
}
checkSession();

// ------------------ ‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü ------------------
document.getElementById("logoutBtn").addEventListener("click", async()=>{
  try {
    const res = await fetch(`${BACKEND}/logout`, { method:"POST", credentials:"include" });
    const data = await res.json();
    if(data.success) window.location.href="login.html";
    else alert("‡¶≤‡¶ó ‡¶Ü‡¶â‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶∏‡¶Æ‡ßç‡¶≠‡¶¨ ‡¶π‡¶Ø‡¶º‡¶®‡¶ø‡•§ ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§");
  } catch(e){
    alert("‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶∏‡¶Æ‡ßü‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§");
  }
});

// ------------------ ‡¶ï‡¶æ‡¶∞‡ßç‡¶ü ‡¶≤‡ßã‡¶° ------------------
async function loadCart(){
  const cartDiv = document.getElementById("cartItems");
  cartDiv.innerHTML = "";
  let total = 0;

  try {
    const res = await fetch(`${BACKEND}/get-cart`, { credentials:"include" });
    const data = await res.json();

    if(data.success && data.cart && data.cart.length > 0){
      data.cart.forEach((item, index)=>{
        const qty = item.quantity || 1;
        total += item.price * qty;

        const div = document.createElement("div");
        div.className = "cart-item";
        div.innerHTML = `
          <img src="${item.image}" alt="${item.name}">
          <div class="cart-item-details">
            <h3>${item.name}</h3>
            <p>‡¶Æ‡ßÇ‡¶≤‡ßç‡¶Ø: ${item.price} ‡¶ü‡¶æ‡¶ï‡¶æ</p>
            <p>‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£: ${qty}</p>
          </div>
          <button class="removeBtn" data-productid="${item.productId}">‡¶∏‡¶∞‡¶æ‡¶®</button>
        `;
        cartDiv.appendChild(div);
      });

      document.getElementById("totalAmount").textContent = total;

      // Remove button
      document.querySelectorAll(".removeBtn").forEach(btn=>{
        btn.addEventListener("click", async ()=>{
          const productId = btn.dataset.productid;
          try {
            const res = await fetch(`${BACKEND}/remove-from-cart`, {
              method:"POST",
              credentials:"include",
              headers:{ "Content-Type":"application/json" },
              body: JSON.stringify({ productId })
            });
            const data = await res.json();
            if(data.success) loadCart();
            else alert("‡¶Ü‡¶á‡¶ü‡ßá‡¶Æ ‡¶∏‡¶∞‡¶æ‡¶®‡ßã ‡¶∏‡¶Æ‡ßç‡¶≠‡¶¨ ‡¶π‡¶Ø‡¶º‡¶®‡¶ø‡•§");
          } catch(e){
            alert("‡¶Ü‡¶á‡¶ü‡ßá‡¶Æ ‡¶∏‡¶∞‡¶æ‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ‡•§ ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞ ‡¶â‡¶™‡¶≤‡¶¨‡ßç‡¶ß ‡¶®‡ßá‡¶á‡•§");
          }
        });
      });

    } else {
      cartDiv.innerHTML = "<p class='empty-cart'>‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ï‡¶æ‡¶∞‡ßç‡¶ü ‡¶è‡¶ñ‡¶® ‡¶ñ‡¶æ‡¶≤‡¶ø‡•§</p>";
      document.getElementById("totalAmount").textContent = "‡ß¶";
    }
  } catch(e){
    // ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï‡¶è‡¶®‡ßç‡¶° ‡¶®‡¶æ ‡¶•‡¶æ‡¶ï‡¶≤‡ßá ‡¶°‡ßá‡¶Æ‡ßã ‡¶ï‡¶æ‡¶∞‡ßç‡¶ü ‡¶¶‡ßá‡¶ñ‡¶æ‡¶á (‡¶´‡¶≤‡ßá dev-friendly)
    console.warn("get-cart failed:", e);
    cartDiv.innerHTML = `
      <div class="cart-item">
        <img src="https://via.placeholder.com/100" alt="Demo plant">
        <div class="cart-item-details">
          <h3>‡¶°‡ßá‡¶Æ‡ßã ‡¶ó‡¶æ‡¶õ</h3>
          <p>‡¶Æ‡ßÇ‡¶≤‡ßç‡¶Ø: ‡ß®‡ß¶‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ</p>
          <p>‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£: 1</p>
        </div>
      </div>
    `;
    document.getElementById("totalAmount").textContent = "‡ß®‡ß¶‡ß¶";
  }
}

// ------------------ ‡¶ö‡ßá‡¶ï‡¶Ü‡¶â‡¶ü ‡¶¨‡ßã‡¶§‡¶æ‡¶Æ -> ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶Æ‡ßã‡¶°‡¶æ‡¶≤ ------------------
const checkoutBtn = document.getElementById("checkoutBtn");
const paymentBackdrop = document.getElementById("paymentBackdrop");
const closePay = document.getElementById("closePay");
const payBtn = document.getElementById("payBtn");
const payStatus = document.getElementById("payStatus");
const demoCheckbox = document.getElementById("demoMode");

checkoutBtn.addEventListener("click", async ()=>{
  // Ensure cart has items (check total)
  const total = Number(document.getElementById("totalAmount").textContent) || 0;
  if(total <= 0){
    alert("‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ï‡¶æ‡¶∞‡ßç‡¶ü ‡¶ñ‡¶æ‡¶≤‡¶ø‡•§ ‡¶Ü‡¶ó‡ßá ‡¶Ü‡¶á‡¶ü‡ßá‡¶Æ ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®‡•§");
    return;
  }
  payStatus.textContent = "";
  paymentBackdrop.style.display = "flex";
});

closePay.addEventListener("click", ()=> {
  paymentBackdrop.style.display = "none";
});

// ‡¶ï‡¶æ‡¶∞‡ßç‡¶° ‡¶á‡¶®‡¶™‡ßÅ‡¶ü ‡¶´‡¶∞‡¶Æ‡ßç‡¶Ø‡¶æ‡¶ü ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® (simple)
document.getElementById("cardNumber").addEventListener("input", (e)=>{
  let v = e.target.value.replace(/\D/g, '').slice(0,16);
  v = v.replace(/(.{4})/g, '$1 ').trim();
  e.target.value = v;
});
document.getElementById("exp").addEventListener("input", (e)=>{
  let v = e.target.value.replace(/\D/g, '').slice(0,4);
  if(v.length >= 3) v = v.slice(0,2) + '/' + v.slice(2);
  e.target.value = v;
});

// ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶™‡ßç‡¶∞‡¶∏‡ßá‡¶∏‡¶ø‡¶Ç
payBtn.addEventListener("click", async ()=>{
  payStatus.textContent = "";
  const name = document.getElementById("cardName").value.trim();
  const cardNumber = document.getElementById("cardNumber").value.replace(/\s/g,'');
  const exp = document.getElementById("exp").value.trim();
  const cvc = document.getElementById("cvc").value.trim();
  const total = Number(document.getElementById("totalAmount").textContent) || 0;

  // Simple validation
  if(!name || cardNumber.length < 12 || !/^\d{2}\/\d{2}$/.test(exp) || cvc.length < 3){
    payStatus.style.color = "crimson";
    payStatus.textContent = "‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶∏‡¶†‡¶ø‡¶ï ‡¶ï‡¶æ‡¶∞‡ßç‡¶° ‡¶°‡¶ø‡¶ü‡ßá‡¶á‡¶≤‡¶∏ ‡¶¶‡¶ø‡¶®‡•§";
    return;
  }

  payBtn.disabled = true;
  payBtn.textContent = "‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶™‡ßç‡¶∞‡¶∏‡ßá‡¶∏‡¶ø‡¶Ç...";

  const demo = demoCheckbox.checked;

  try {
    if(demo){
      // Demo: ‡¶∏‡¶ø‡¶Æ‡ßÅ‡¶≤‡ßá‡¶ü‡ßá‡¶° ‡¶ü‡ßã‡¶ï‡ßá‡¶® ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßá ‡¶≤‡ßã‡¶ï‡¶æ‡¶≤‡¶ø ‡¶∏‡¶´‡¶≤‡¶§‡¶æ ‡¶¶‡ßá‡¶ñ‡¶æ‡¶á
      payStatus.style.color = "#333";
      payStatus.textContent = "‡¶°‡ßá‡¶Æ‡ßã ‡¶Æ‡ßã‡¶°‡ßá ‚Äî ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶∏‡¶ø‡¶Æ‡ßÅ‡¶≤‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...";
      await new Promise(r => setTimeout(r, 2000)); // ‡ß® ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶°
      const fakeResponse = { success: true, transactionId: "DEMO-" + Date.now() };

      if(fakeResponse.success){
        payStatus.style.color = "#0a7";
        payStatus.textContent = "‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶∏‡¶´‡¶≤! Trans ID: " + fakeResponse.transactionId;
        // ‡¶è‡¶ñ‡¶® /checkout ‡¶ï‡¶≤ ‡¶ï‡¶∞‡ßá ‡¶ï‡¶æ‡¶∞‡ßç‡¶ü ‡¶ï‡ßç‡¶≤‡¶ø‡ßü‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ ‡¶Ø‡ßá‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá
        await finalizeOrder();
      } else {
        payStatus.style.color = "crimson";
        payStatus.textContent = "‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶• ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§";
      }

    } else {
      // ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï‡¶è‡¶®‡ßç‡¶°‡ßá ‡¶™‡¶æ‡¶†‡¶æ‡¶ì ‚Äî ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï‡¶è‡¶®‡ßç‡¶°‡¶ï‡ßá /process-payment endpoint ‡¶∏‡¶∞‡¶¨‡¶∞‡¶æ‡¶π ‡¶ï‡¶∞‡¶§‡ßá ‡¶π‡¶¨‡ßá
      const payload = {
        name, cardLast4: cardNumber.slice(-4), exp, cvc: cvc.replace(/\d/g,'*'), // ‡¶®‡¶ø‡¶∞‡¶æ‡¶™‡¶§‡ßç‡¶§‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø cvc masking; ‡¶¨‡¶æ‡¶∏‡ßç‡¶§‡¶¨‡ßá ‡¶ü‡ßã‡¶ï‡ßá‡¶®‡¶æ‡¶á‡¶ú ‡¶ï‡¶∞‡¶§‡ßá ‡¶π‡¶¨‡ßá
        amount: total
      };

      const res = await fetch(`${BACKEND}/process-payment`, {
        method: "POST",
        credentials: "include",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
      });

      const data = await res.json();
      if(data.success){
        payStatus.style.color = "#0a7";
        payStatus.textContent = "‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶∏‡¶´‡¶≤! Trans ID: " + (data.transactionId || "N/A");
        await finalizeOrder();
      } else {
        payStatus.style.color = "crimson";
        payStatus.textContent = "‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•: " + (data.message || "Unknown error");
      }
    }
  } catch(e){
    console.error("Payment error:", e);
    payStatus.style.color = "crimson";
    payStatus.textContent = "‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶∏‡¶Æ‡ßü ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø ‡¶π‡¶≤‡ßã (‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞ ‡¶Ö‡¶®‡ßÅ‡¶™‡¶≤‡¶¨‡ßç‡¶ß)‡•§";
  } finally {
    payBtn.disabled = false;
    payBtn.textContent = "‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®";
  }
});

// Checkout finalization: backend /checkout to clear cart or show order created
async function finalizeOrder(){
  try {
    const res = await fetch(`${BACKEND}/checkout`, { method:"POST", credentials:"include" });
    const data = await res.json();
    if(data.success){
      // show success, hide modal, reload cart
      setTimeout(()=> {
        alert("‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶® ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá! ‡¶ß‡¶®‡ßç‡¶Ø‡¶¨‡¶æ‡¶¶‡•§");
        paymentBackdrop.style.display = "none";
        loadCart();
      }, 500);
    } else {
      // ‡¶Ø‡¶¶‡¶ø ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï‡¶è‡¶®‡ßç‡¶° ‡¶®‡¶æ ‡¶•‡¶æ‡¶ï‡ßá ‡¶§‡¶ñ‡¶® ‡¶∂‡ßÅ‡¶ß‡ßÅ ‡¶≤‡ßã‡¶ï‡¶æ‡¶≤‡¶ø ‡¶ï‡¶æ‡¶∞‡ßç‡¶ü ‡¶ï‡ßç‡¶≤‡¶ø‡ßü‡¶æ‡¶∞
      console.warn("checkout endpoint failed or returned false:", data);
      alert("‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶§‡ßà‡¶∞‡¶ø ‡¶π‡¶≤‡ßã, ‡¶ï‡¶ø‡¶®‡ßç‡¶§‡ßÅ ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡ßü‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡¶®‡¶ø‡•§ (‡¶°‡ßá‡¶Æ‡ßã ‡¶Æ‡ßã‡¶°‡ßá)‡•§");
      paymentBackdrop.style.display = "none";
      loadCart();
    }
  } catch(e){
    console.warn("checkout call failed:", e);
    // ‡¶°‡ßá‡¶Æ‡ßã ‡¶´‡ßç‡¶≤‡ßã ‚Äî ‡¶∂‡ßÅ‡¶ß‡ßÅ UI ‡¶Ü‡¶™‡¶°‡ßá‡¶ü
    alert("‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶∏‡¶´‡¶≤ (‡¶≤‡ßã‡¶ï‡¶æ‡¶≤‡¶ø)‡•§");
    paymentBackdrop.style.display = "none";
    loadCart();
  }
}

// ‡¶™‡ßç‡¶∞‡¶•‡¶Æ ‡¶≤‡ßã‡¶°
loadCart();
</script>

</body>
</html>
