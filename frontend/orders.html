<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞‡¶∏‡¶Æ‡ßÇ‡¶π üåø GreenNest</title>
<style>
body { font-family:'Poppins', sans-serif; margin:0; background: #f0f8f5; color:#333; }
header { background: linear-gradient(90deg,#00BFA6,#00C897,#00E7B0); padding:15px 30px; display:flex; justify-content: space-between; align-items:center; }
.nav a { color:white; text-decoration:none; margin:0 15px; font-weight:600; }
.nav a:hover, .nav a.active { text-decoration:underline; }
#logoutBtn { background:white; color:#00BFA6; border:none; border-radius:20px; padding:8px 18px; font-weight:600; cursor:pointer; }

.orders-container { max-width:900px; margin:40px auto; background:white; border-radius:20px; padding:30px; box-shadow:0 10px 25px rgba(0,0,0,0.1); }
.orders-container h2 { text-align:center; margin-bottom:20px; color:#00BFA6; }
.order-card { border:1px solid #B2DFDB; border-radius:15px; padding:15px; margin-bottom:15px; }
.order-card button { background:linear-gradient(90deg,#00BFA6,#00E7B0); color:white; border:none; border-radius:10px; padding:5px 10px; cursor:pointer; }
</style>
</head>
<body>

<header>
  <nav class="nav">
    <a href="index.html">‡¶π‡ßã‡¶Æ</a>
    <a href="shop.html">‡¶ó‡¶æ‡¶õ ‡¶ï‡¶ø‡¶®‡ßÅ‡¶®</a>
    <a href="categories.html">‡¶ó‡¶æ‡¶õ‡ßá‡¶∞ ‡¶ß‡¶∞‡¶®</a>
    <a href="care.html">‡¶™‡¶∞‡¶ø‡¶ö‡¶∞‡ßç‡¶Ø‡¶æ ‡¶™‡¶∞‡¶æ‡¶Æ‡¶∞‡ßç‡¶∂</a>
    <a href="about.html">‡¶Ü‡¶Æ‡¶æ‡¶¶‡ßá‡¶∞ ‡¶∏‡¶Æ‡ßç‡¶™‡¶∞‡ßç‡¶ï‡ßá</a>
    <a href="contact.html">‡¶Ø‡ßã‡¶ó‡¶æ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</a>
    <a href="profile.html">‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤</a>
  </nav>
</header>

<div class="orders-container">
<h2>‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞‡¶∏‡¶Æ‡ßÇ‡¶π</h2>
<div id="ordersList">
<!-- ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞‡¶∏‡¶Æ‡ßÇ‡¶π ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶≤‡ßã‡¶° ‡¶π‡¶¨‡ßá -->
</div>
</div>

<script>
const BACKEND="http://127.0.0.1:5000";

// ‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
function toBanglaNumber(str){
  const bnNums = ['‡ß¶','‡ßß','‡ß®','‡ß©','‡ß™','‡ß´','‡ß¨','‡ß≠','‡ßÆ','‡ßØ'];
  return str.toString().replace(/\d/g, d => bnNums[d]);
}

// ‡¶∏‡ßá‡¶∂‡¶® ‡¶ö‡ßá‡¶ï
async function checkSession(){
  const res = await fetch(`${BACKEND}/check-session`, { credentials:"include" });
  const data = await res.json();
  if(!data.loggedIn) window.location.href="login.html";
}
checkSession();

// ‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü
document.getElementById("logoutBtn").addEventListener("click", async()=>{
  const res = await fetch(`${BACKEND}/logout`, { method:"POST", credentials:"include" });
  const data = await res.json();
  if(data.success) window.location.href="login.html"; else alert("‡¶≤‡¶ó ‡¶Ü‡¶â‡¶ü ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶• ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§");
});

// ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶≤‡ßã‡¶°
async function loadOrders(){
  const res = await fetch(`${BACKEND}/my-orders`, { credentials:"include" });
  const data = await res.json();
  const ordersList = document.getElementById("ordersList");
  ordersList.innerHTML="";
  
  if(data.orders && data.orders.length>0){
    data.orders.forEach(order=>{
      const div = document.createElement("div");
      div.className="order-card";
      div.innerHTML=`
        <h3>‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ #${toBanglaNumber(order.id)}</h3>
        <p>‡¶Ü‡¶á‡¶ü‡ßá‡¶Æ‡¶∏‡¶Æ‡ßÇ‡¶π: ${order.items.map(i=>i.name).join(", ")}</p>
        <p>‡¶Æ‡ßã‡¶ü: ‡ß≥${toBanglaNumber(order.total)}</p>
        <button onclick="cancelOrder(${order.id})">‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶¨‡¶æ‡¶§‡¶ø‡¶≤ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
      `;
      ordersList.appendChild(div);
    });
  } else {
    ordersList.innerHTML="<p>‡¶ï‡ßã‡¶®‡¶ì ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶®‡ßá‡¶á‡•§</p>";
  }
}

// ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶¨‡¶æ‡¶§‡¶ø‡¶≤
async function cancelOrder(orderId){
  if(!confirm("‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶∏‡¶§‡ßç‡¶Ø‡¶ø‡¶á ‡¶è‡¶á ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶¨‡¶æ‡¶§‡¶ø‡¶≤ ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶®?")) return;
  const res = await fetch(`${BACKEND}/cancel-order/${orderId}`, { method:"POST", credentials:"include" });
  const data = await res.json();
  if(data.success){ 
    alert("‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶¨‡¶æ‡¶§‡¶ø‡¶≤ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!");
    loadOrders();  // ‡¶¨‡¶æ‡¶§‡¶ø‡¶≤ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶™‡¶∞‡ßá ‡¶™‡ßÅ‡¶®‡¶∞‡¶æ‡¶Ø‡¶º ‡¶≤‡ßã‡¶°
  } 
  else alert("‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶¨‡¶æ‡¶§‡¶ø‡¶≤ ‡¶ï‡¶∞‡¶§‡ßá ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶• ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§");
}

// ‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡ß´ ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶°‡ßá ‡¶®‡¶§‡ßÅ‡¶® ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶ö‡ßá‡¶ï
setInterval(loadOrders, 5000);

// ‡¶™‡ßç‡¶∞‡¶•‡¶Æ ‡¶≤‡ßã‡¶°
loadOrders();
</script>

</body>
</html>
