<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡¶ï‡¶æ‡¶∞‡ßÄ‡¶∞ ‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ üåø GreenNest</title>
<style>
body { font-family:'Poppins', sans-serif; margin:0; background: #d2d4d5; color:#333; }
header { background: linear-gradient(90deg,#00BFA6,#00C897,#00E7B0); padding:15px 30px; display:flex; justify-content: space-between; align-items:center; }
.nav a { color:white; text-decoration:none; margin:0 15px; font-weight:600; }
.nav a:hover, .nav a.active { text-decoration:underline; }
#logoutBtn { background:white; color:#00BFA6; border:none; border-radius:20px; padding:9px 18px; font-weight:600; cursor:pointer; }

.profile-container, .cart-container { max-width:700px; margin:40px auto; background:rgb(247, 251, 252); border-radius:20px; padding:30px; box-shadow:0 10px 25px rgba(0,0,0,0.1); text-align:center; }

.profile-container h2, .cart-container h2 { text-align:center; margin-bottom:20px; color:#06fa06; }

.form-group { margin-bottom:15px; text-align:left; }
label { font-weight:600; color:#00695C; display:block; margin-bottom:5px; }
input, textarea { width:100%; padding:10px; border-radius:10px; border:2px solid #B2DFDB; font-size:15px; transition:0.3s; }
input:focus, textarea:focus { border-color:#00A884; outline:none; box-shadow:0 0 8px rgba(0,168,132,0.4); }

button { display:block; margin:15px auto 0; background:linear-gradient(90deg,#00BFA6,#00E7B0); color:white; border:none; border-radius:15px; padding:10px 20px; font-size:16px; font-weight:600; cursor:pointer; transition:0.3s; }
button:hover { transform:scale(1.05); background:linear-gradient(90deg,#00E7B0,#00BFA6); }

#profilePicPreview { width:120px; height:120px; border-radius:50%; object-fit:cover; margin:10px auto; display:block; border:2px solid #B2DFDB; }

.profile-links { display: flex; justify-content: center; gap: 20px; margin-top: 25px; }
.profile-links a { text-decoration: none; background: linear-gradient(90deg,#00BFA6,#00E7B0); color: white; padding: 10px 25px; border-radius: 25px; font-weight: 600; transition: 0.3s; }
.profile-links a:hover { transform: scale(1.05); background: linear-gradient(90deg,#00E7B0,#00BFA6); }

/* ‡¶ï‡¶æ‡¶∞‡ßç‡¶ü ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ */
.cart-item { display:flex; align-items:center; margin-bottom:15px; border-bottom:1px solid #ddd; padding-bottom:10px; }
.cart-item img { width:100px; height:100px; object-fit:cover; border-radius:15px; margin-right:20px; }
.cart-item-details { flex:1; }
button.removeBtn { background:red; padding:5px 10px; border:none; border-radius:10px; color:white; cursor:pointer; margin-left:10px; transition:0.2s; }
button.removeBtn:hover { transform:scale(1.05); }
.total { text-align:right; font-weight:600; margin-top:20px; }
#checkoutBtn { background:#00BFA6; color:white; border:none; border-radius:20px; padding:10px 20px; cursor:pointer; margin-top:15px; font-weight:600; transition:0.2s; }
#checkoutBtn:hover { background:#00E7B0; }
</style>
</head>
<body>

<header>
  <nav class="nav">
    <a href="index.html">‡¶π‡ßã‡¶Æ</a>
    <a href="./shop.html">‡¶ó‡¶æ‡¶õ ‡¶ï‡¶ø‡¶®‡ßÅ‡¶®</a>
    <a href="./categories.html">‡¶ó‡¶æ‡¶õ‡ßá‡¶∞ ‡¶ß‡¶∞‡¶®</a>
    <a href="./care.html">‡¶™‡¶∞‡¶ø‡¶ö‡¶∞‡ßç‡¶Ø‡¶æ ‡¶™‡¶∞‡¶æ‡¶Æ‡¶∞‡ßç‡¶∂</a>
    <a href="./about.html">‡¶Ü‡¶Æ‡¶æ‡¶¶‡ßá‡¶∞ ‡¶∏‡¶Æ‡ßç‡¶™‡¶∞‡ßç‡¶ï‡ßá</a>
    <a href="./contact.html">‡¶Ø‡ßã‡¶ó‡¶æ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</a>
  </nav>
  <button id="logoutBtn">‡¶≤‡¶ó ‡¶Ü‡¶â‡¶ü</button>
</header>

<!-- ‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶∏‡ßá‡¶ï‡¶∂‡¶® -->
<div class="profile-container">
<h2>‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡¶ï‡¶æ‡¶∞‡ßÄ‡¶∞ ‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤</h2>
<img id="profilePicPreview" src="./pictures of index/default-profile.png" alt="‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶õ‡¶¨‡¶ø">

<form id="profileForm" enctype="multipart/form-data">
  <div class="form-group">
    <label for="name">‡¶®‡¶æ‡¶Æ</label>
    <input type="text" id="name" name="name" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®">
  </div>
  <div class="form-group">
    <label for="email">‡¶á‡¶Æ‡ßá‡¶≤</label>
    <input type="email" id="email" name="email" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶á‡¶Æ‡ßá‡¶≤ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®">
  </div>
  <div class="form-group">
    <label for="phone">‡¶´‡ßã‡¶® ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞</label>
    <input type="text" id="phone" name="phone" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶´‡ßã‡¶® ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®">
  </div>
  <div class="form-group">
    <label for="address">‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ</label>
    <textarea id="address" name="address" rows="3" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®"></textarea>
  </div>
  <div class="form-group">
    <label for="profilePic">‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶õ‡¶¨‡¶ø</label>
    <input type="file" id="profilePic" name="profilePic" accept="image/*">
  </div>
  <button type="submit">‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
</form>

<div class="profile-links">
  <a href="./cart.html">üõí ‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶ï‡¶æ‡¶∞‡ßç‡¶ü</a>
  <a href="./orders.html">üì¶ ‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞‡¶∏‡¶Æ‡ßÇ‡¶π</a>
</div>
</div>

<!-- ‡¶ï‡¶æ‡¶∞‡ßç‡¶ü ‡¶∏‡ßá‡¶ï‡¶∂‡¶® -->
<div class="cart-container">
<h2>‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶ï‡¶æ‡¶∞‡ßç‡¶ü</h2>
<div id="cartItems"></div>
<p class="total">‡¶Æ‡ßã‡¶ü: ‡ß≥<span id="totalAmount">‡ß¶</span></p>
<button id="checkoutBtn">‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
</div>

<script>
const BACKEND="http://127.0.0.1:5000";

// ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ ‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ‡¶Ø‡¶º ‡¶∞‡ßÇ‡¶™‡¶æ‡¶®‡ßç‡¶§‡¶∞
function toBanglaNumber(str){
  const bnNums = ['‡ß¶','‡ßß','‡ß®','‡ß©','‡ß™','‡ß´','‡ß¨','‡ß≠','‡ßÆ','‡ßØ'];
  return str.toString().replace(/\d/g, d => bnNums[d]);
}

// ‡¶∏‡ßá‡¶∂‡¶® ‡¶ö‡ßá‡¶ï
fetch(`${BACKEND}/check-session`, { credentials: "include" })
  .then(res => res.json())
  .then(data => { if (!data.loggedIn) window.location.href = "login.html"; });

// ‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü
document.getElementById("logoutBtn").addEventListener("click", async () => {
  const res = await fetch(`${BACKEND}/logout`, { method: "POST", credentials: "include" });
  const data = await res.json();
  if (data.success) window.location.href = "login.html";
});

// ‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶≤‡ßã‡¶°
async function loadProfile() {
  const res = await fetch(`${BACKEND}/get-profile`, { credentials: "include" });
  const data = await res.json();
  if (data.success) {
    const p = data.profile;
    document.getElementById("name").value = p.name || "";
    document.getElementById("email").value = p.email || "";
    document.getElementById("phone").value = p.phone ? toBanglaNumber(p.phone) : "";
    document.getElementById("address").value = p.address || "";
    if (p.profilePic) document.getElementById("profilePicPreview").src = BACKEND + p.profilePic;
  }
}

// ‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶õ‡¶¨‡¶ø ‡¶™‡ßç‡¶∞‡¶ø‡¶≠‡¶ø‡¶â
document.getElementById("profilePic").addEventListener("change", e => {
  const file = e.target.files[0];
  if (file) {
    const reader = new FileReader();
    reader.onload = () => document.getElementById("profilePicPreview").src = reader.result;
    reader.readAsDataURL(file);
  }
});

// ‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£
document.getElementById("profileForm").addEventListener("submit", async e => {
  e.preventDefault();
  const formData = new FormData(e.target);
  const res = await fetch(`${BACKEND}/update-profile`, {
    method: "POST",
    body: formData,
    credentials: "include",
  });
  const data = await res.json();
  alert(data.success ? "‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!" : "‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£ ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶• ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§");
  loadProfile();
});

// ‡¶ï‡¶æ‡¶∞‡ßç‡¶ü ‡¶≤‡ßã‡¶°
async function loadCart(){
  const res = await fetch(`${BACKEND}/get-cart`, { credentials:"include" });
  const data = await res.json();
  const cartDiv = document.getElementById("cartItems");
  cartDiv.innerHTML = "";
  let total = 0;

  if(data.success && data.cart.length > 0){
    data.cart.forEach((item,index)=>{
      total += item.price;
      const div = document.createElement("div");
      div.className = "cart-item";
      div.innerHTML = `
        <img src="${item.image}" alt="${item.name}">
        <div class="cart-item-details">
          <h3>${item.name}</h3>
          <p>‡¶Æ‡ßÇ‡¶≤‡ßç‡¶Ø: ‡ß≥${toBanglaNumber(item.price)}</p>
        </div>
        <button class="removeBtn" data-index="${index}">‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡ßÅ‡¶®</button>
      `;
      cartDiv.appendChild(div);
    });
    document.getElementById("totalAmount").textContent = toBanglaNumber(total);

    document.querySelectorAll(".removeBtn").forEach(btn=>{
      btn.addEventListener("click", async ()=>{
        const idx = parseInt(btn.dataset.index);
        const res = await fetch(`${BACKEND}/remove-from-cart`, {
          method:"POST",
          credentials:"include",
          headers:{ "Content-Type":"application/json" },
          body: JSON.stringify({index:idx})
        });
        const data = await res.json();
        if(data.success) loadCart();
        else alert("‡¶Ü‡¶á‡¶ü‡ßá‡¶Æ ‡¶Æ‡ßÅ‡¶õ‡¶§‡ßá ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶• ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§");
      });
    });
  } else {
    cartDiv.innerHTML = "<p>‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ï‡¶æ‡¶∞‡ßç‡¶ü ‡¶ñ‡¶æ‡¶≤‡¶ø‡•§</p>";
    document.getElementById("totalAmount").textContent = toBanglaNumber(0);
  }
}

// ‡¶ö‡ßá‡¶ï‡¶Ü‡¶â‡¶ü
document.getElementById("checkoutBtn").addEventListener("click", async ()=>{
  const res = await fetch(`${BACKEND}/checkout`, { method:"POST", credentials:"include" });
  const data = await res.json();
  if(data.success){
    alert("‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶® ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!");
    loadCart();
  } else alert("‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶• ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá: " + (data.message || ""));
});

loadProfile();
loadCart();
</script>

</body>
</html>
