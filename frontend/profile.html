<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>User Profile ðŸŒ¿ GreenNest</title>
<style>
body { font-family:'Poppins', sans-serif; margin:0; background: #f0f8f5; color:#333; }
header { background: linear-gradient(90deg,#00BFA6,#00C897,#00E7B0); padding:15px 30px; display:flex; justify-content: space-between; align-items:center; }
.nav a { color:white; text-decoration:none; margin:0 15px; font-weight:600; }
.nav a:hover, .nav a.active { text-decoration:underline; }
#logoutBtn { background:white; color:#00BFA6; border:none; border-radius:20px; padding:8px 18px; font-weight:600; cursor:pointer; }

.profile-container { max-width:700px; margin:40px auto; background:white; border-radius:20px; padding:30px; box-shadow:0 10px 25px rgba(0,0,0,0.1); text-align:center; }
.profile-container h2 { text-align:center; margin-bottom:20px; color:#00BFA6; }
.form-group { margin-bottom:15px; text-align:left; }
label { font-weight:600; color:#00695C; display:block; margin-bottom:5px; }
input, textarea { width:100%; padding:10px; border-radius:10px; border:2px solid #B2DFDB; font-size:15px; transition:0.3s; }
input:focus, textarea:focus { border-color:#00A884; outline:none; box-shadow:0 0 8px rgba(0,168,132,0.4); }

button { display:block; margin:15px auto 0; background:linear-gradient(90deg,#00BFA6,#00E7B0); color:white; border:none; border-radius:15px; padding:10px 20px; font-size:16px; font-weight:600; cursor:pointer; transition:0.3s; }
button:hover { transform:scale(1.05); background:linear-gradient(90deg,#00E7B0,#00BFA6); }

#profilePicPreview { width:120px; height:120px; border-radius:50%; object-fit:cover; margin:10px auto; display:block; border:2px solid #B2DFDB; }

/* ðŸŒ¿ Styled Links for My Cart & My Orders */
.profile-links {
  display: flex;
  justify-content: center;
  gap: 20px;
  margin-top: 25px;
}
.profile-links a {
  text-decoration: none;
  background: linear-gradient(90deg,#00BFA6,#00E7B0);
  color: white;
  padding: 10px 25px;
  border-radius: 25px;
  font-weight: 600;
  transition: 0.3s;
}
.profile-links a:hover {
  transform: scale(1.05);
  background: linear-gradient(90deg,#00E7B0,#00BFA6);
}
</style>
</head>
<body>

<header>
  <nav class="nav">
    <a href="index.html">Home</a>
    <a href="./shop.html">Shop Plants</a>
    <a href="./categories.html">Categories</a>
    <a href="./care.html">Plant Care</a>
    <a href="./about.html">About</a>
    <a href="./contact.html">Contact Us</a>
    <a href="profile.html" class="active">Profile</a>
  </nav>
  <button id="logoutBtn">Logout</button>
</header>

<div class="profile-container">
<h2>User Profile</h2>
<img id="profilePicPreview" src="./pictures of index/default-profile.png" alt="Profile Picture">

<form id="profileForm" enctype="multipart/form-data">
  <div class="form-group">
    <label for="name">Name</label>
    <input type="text" id="name" name="name" placeholder="Enter your name">
  </div>
  <div class="form-group">
    <label for="email">Email</label>
    <input type="email" id="email" name="email" placeholder="Enter your email">
  </div>
  <div class="form-group">
    <label for="phone">Phone Number</label>
    <input type="text" id="phone" name="phone" placeholder="Enter your phone">
  </div>
  <div class="form-group">
    <label for="address">Address</label>
    <textarea id="address" name="address" rows="3" placeholder="Enter your address"></textarea>
  </div>
  <div class="form-group">
    <label for="profilePic">Profile Picture</label>
    <input type="file" id="profilePic" name="profilePic" accept="image/*">
  </div>
  <button type="submit">Save Profile</button>
</form>

<!-- ðŸŒ¿ My Cart & My Orders Buttons -->
<div class="profile-links">
  <a href="./cart.html">ðŸ›’ My Cart</a>
  <a href="./orders.html">ðŸ“¦ My Orders</a>
</div>
</div>

<script>
const BACKEND = "http://127.0.0.1:5000";

// Check session
fetch(`${BACKEND}/check-session`, { credentials: "include" })
  .then(res => res.json())
  .then(data => { if (!data.loggedIn) window.location.href = "login.html"; });

// Logout
document.getElementById("logoutBtn").addEventListener("click", async () => {
  const res = await fetch(`${BACKEND}/logout`, { method: "POST", credentials: "include" });
  const data = await res.json();
  if (data.success) window.location.href = "login.html";
});

// Load profile
async function loadProfile() {
  const res = await fetch(`${BACKEND}/get-profile`, { credentials: "include" });
  const data = await res.json();
  if (data.success) {
    const p = data.profile;
    document.getElementById("name").value = p.name || "";
    document.getElementById("email").value = p.email || "";
    document.getElementById("phone").value = p.phone || "";
    document.getElementById("address").value = p.address || "";
    if (p.profilePic) document.getElementById("profilePicPreview").src = BACKEND + p.profilePic;
  }
}

// Preview upload
document.getElementById("profilePic").addEventListener("change", e => {
  const file = e.target.files[0];
  if (file) {
    const reader = new FileReader();
    reader.onload = () => document.getElementById("profilePicPreview").src = reader.result;
    reader.readAsDataURL(file);
  }
});

// Save profile
document.getElementById("profileForm").addEventListener("submit", async e => {
  e.preventDefault();
  const formData = new FormData(e.target);
  const res = await fetch(`${BACKEND}/update-profile`, {
    method: "POST",
    body: formData,
    credentials: "include",
  });
  const data = await res.json();
  alert(data.success ? "Profile updated successfully!" : "Failed to save.");
  loadProfile();
});

loadProfile();
</script>

</body>
</html>
